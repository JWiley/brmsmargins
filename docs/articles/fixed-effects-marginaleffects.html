<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Marginal Effects for Fixed Effects Models • brmsmargins</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Marginal Effects for Fixed Effects Models">
<meta property="og:description" content="brmsmargins">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brmsmargins</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fixed-effects-marginaleffects.html">Marginal Effects for Fixed Effects Models</a>
    </li>
    <li>
      <a href="../articles/mixed-effects-marginaleffects.html">Marginal Effects for Mixed Effects Models</a>
    </li>
    <li>
      <a href="../articles/location-scale-marginaleffects.html">Marginal Effects for Location Scale Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JWiley/brmsmargins/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="fixed-effects-marginaleffects_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Marginal Effects for Fixed Effects Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JWiley/brmsmargins/blob/master/vignettes/fixed-effects-marginaleffects.Rmd"><code>vignettes/fixed-effects-marginaleffects.Rmd</code></a></small>
      <div class="hidden name"><code>fixed-effects-marginaleffects.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="co">#&gt; data.table 1.14.2 using 24 threads (see ?getDTthreads).  Latest news: r-datatable.com</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: Rcpp</span>
<span class="co">#&gt; Loading 'brms' package (version 2.16.3). Useful instructions</span>
<span class="co">#&gt; can be found by typing help('brms'). A more detailed introduction</span>
<span class="co">#&gt; to the package is available through vignette('brms_overview').</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'brms'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     ar</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://joshuawiley.com/brmsmargins">brmsmargins</a></span><span class="op">)</span></code></pre></div>
<p>This vignette provides a brief overview of how to calculate marginal effects for Bayesian regression models involving only fixed effects and fit using the <code>brms</code> package.</p>
<div id="what-are-marginal-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#what-are-marginal-effects" class="anchor"></a>What are marginal effects?</h2>
<p>Marginal effects can be used to describe how an outcome is predicted to change with a change in a predictor (or predictors). It is a derivative. For convenience, typically calculated numerically rather than analytically.</p>
<p>To motivate marginal effects, we can look at some regression models fit in a frequentist framework for simplicity and speed. Here we use the <code>mtcars</code> dataset built into <code>R</code>. First, we can look at a linear regression model of the association between <code>mpg</code> and <code>hp</code>. Here we can see the estimated regression coefficient for <code>mpg</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m.linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hp</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m.linear</span><span class="op">)</span><span class="op">[</span><span class="st">"mpg"</span><span class="op">]</span>
<span class="co">#&gt;       mpg </span>
<span class="co">#&gt; -11.19988</span></code></pre></div>
<p>In linear models with no interactions, no (non linear) transformations, and a linear link function, the regression coefficient is the predicted change in the outcome for a one unit change in the predictor, regardless of any other values. For example, here we can look at the predicted difference in the outcome for a one unit difference in <code>mpg</code> from 0 to 1, holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.linear</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;         2 </span>
<span class="co">#&gt; -11.19988</span></code></pre></div>
<p>We can look at the same estimate but moving <code>mpg</code> from 10 to 11 instead 0 to 1, holding <code>am = 1</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.linear</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">1</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;         2 </span>
<span class="co">#&gt; -11.19988</span></code></pre></div>
<p>All of these quantities are identical. In this case, the regression coefficient can be interpreted as a marginal effect: the expected change in the outcome for a one unit shift in <code>mpg</code>, regardless of the value of <code>am</code> and regardless of the values where <code>mpg</code> is evaluated.</p>
<p>This convenient property does not hold for many types of models. Next consider a logistic regression model. The regression coefficient, shown below, is on the log odds scale, not the probability scale. This is not convenient for interpretation, as the log odds scale is not the same scale as our outcome.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m.logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span><span class="op">[</span><span class="st">"mpg"</span><span class="op">]</span>
<span class="co">#&gt;       mpg </span>
<span class="co">#&gt; 0.6809205</span></code></pre></div>
<p>We can find predicted differences on the probability scale. Here moving <code>mpg</code> from 10 to 11 holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;           2 </span>
<span class="co">#&gt; 0.002661989</span></code></pre></div>
<p>We can look at the same estimate but moving <code>mpg</code> from 20 to 21 instead 10 to 11 again holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;         2 </span>
<span class="co">#&gt; 0.1175344</span></code></pre></div>
<p>We can look at the same estimate moving <code>mpg</code> from 20 to 21 as before, but this time holding <code>am = 1</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">1</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;          2 </span>
<span class="co">#&gt; 0.08606869</span></code></pre></div>
<p>All the estimates in this case differ. The association between <code>mpg</code> and <strong>probability</strong> of <code>vs</code> is not linear. Marginal effects provide a way to get results on the response scale, which can aid interpretation.</p>
<p>A common type of marginal effect is an average marginal effect (AME). To calculate an AME numerically, we can get predicted probabilities from a model for every observation in the dataset. For continuous variables, we might use a very small difference to approximate the derivative. For categorical variables, we might calculate a discrete difference.</p>
<div id="average-marginal-effect-ame" class="section level3">
<h3 class="hasAnchor">
<a href="#average-marginal-effect-ame" class="anchor"></a>Average Marginal Effect (AME)</h3>
<p>Here is an example of a continuous AME. <code>h</code> is a value near to zero used for the numerical derivative. We take all the values observed in the dataset for the first set of predicted probabilities. Then we take the observed values + <code>h</code> and calculate new predicted probabilities. The difference, divided by <code>h</code> is the “instantaneous” (i.e., derivative) on the probability scale for a one unit shift in the predictor, <code>mpg</code>, for each person. When we average all of these, we get the AME.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>

<span class="va">nd.1</span> <span class="op">&lt;-</span> <span class="va">nd.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html">model.frame</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span>
<span class="va">nd.1</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="va">nd.1</span><span class="op">$</span><span class="va">mpg</span> <span class="op">+</span> <span class="va">h</span>

<span class="va">yhat.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.0</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="va">yhat.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.1</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">yhat.1</span> <span class="op">-</span> <span class="va">yhat.0</span><span class="op">)</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.06922997</span></code></pre></div>
<p>Here is an example of a discrete AME. The variable, <code>am</code> only takes two values: 0 or 1. So we calculate predicted probabilities if everyone had <code>am = 0</code> and then again if everyone had <code>am = 1</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nd.1</span> <span class="op">&lt;-</span> <span class="va">nd.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html">model.frame</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span>
<span class="va">nd.0</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">nd.1</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="va">yhat.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.0</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="va">yhat.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.1</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">yhat.1</span> <span class="op">-</span> <span class="va">yhat.0</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] -0.2618203</span></code></pre></div>
<p>In both these examples, we are averaging across the different values observed in the dataset. In a frequentist framework, additional details are needed to calculate uncertainty intervals. In a Bayesian framework, uncertainty intervals can be calculated readily by summarizing the posterior.</p>
</div>
</div>
<div id="ames-for-logistic-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#ames-for-logistic-regression" class="anchor"></a>AMEs for Logistic Regression</h2>
<p>The main function for users to use is <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code>. Here is an example calculating AMEs for <code>mpg</code> and <code>am</code>. First we will fit the same logistic regression model using <code>brms</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bayes.logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>
  <span class="va">vs</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>,
  family <span class="op">=</span> <span class="st">"bernoulli"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,
  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span>
<span class="co">#&gt; Compiling Stan program...</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bayes.logistic</span><span class="op">)</span>
<span class="co">#&gt;  Family: bernoulli </span>
<span class="co">#&gt;   Links: mu = logit </span>
<span class="co">#&gt; Formula: vs ~ am + mpg </span>
<span class="co">#&gt;    Data: mtcars (Number of observations: 32) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 1000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept   -16.13      5.56   -28.70    -7.35 1.00     1826     1853</span>
<span class="co">#&gt; am           -3.80      1.84    -7.83    -0.70 1.00     1663     1449</span>
<span class="co">#&gt; mpg           0.87      0.30     0.39     1.55 1.00     1702     1854</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>Now we can use <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code>. We give it the model object, a <code>data.frame</code> of the values to be added, first 0, then (0 + h), and a contrast matrix. The default is a 99 percent credible interval, which we override here to 0.95. We use highest density intervals, which are the default. We also could have selected “ETI” for equal tail intervals. <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code> will return a list with the posterior of each prediction, a summary of the posterior for the predictions, the posterior for the contrasts, and a summary of the posterior for the contrasts. Here we just have the one contrast, but multiple could have been specified.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>
<span class="va">ame1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.logistic</span>,
  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"AME MPG"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  CI <span class="op">=</span> <span class="fl">0.95</span>, CIType <span class="op">=</span> <span class="st">"HDI"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame1</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.071</td>
<td align="right">0.07</td>
<td align="right">0.053</td>
<td align="right">0.091</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME MPG</td>
</tr></tbody>
</table>
<p>Now we can look at how we could calculate a discrete AME. This time we use the <code>at</code> argument instead of the <code>add</code> argument as we want to hold <code>am</code> at specific values, not add 0 and 1 to the observed <code>am</code> values. Because 0 and 1 are meaningful values of <code>am</code>, we also look at the summary of the posterior for the predictions. These predictions average across all values of <code>mpg</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ame2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.logistic</span>,
  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"AME am"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  CI <span class="op">=</span> <span class="fl">0.95</span>, CIType <span class="op">=</span> <span class="st">"HDI"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame2</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.543</td>
<td align="right">0.545</td>
<td align="right">0.421</td>
<td align="right">0.652</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.284</td>
<td align="right">0.277</td>
<td align="right">0.177</td>
<td align="right">0.406</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame2</span><span class="op">$</span><span class="va">ContrastSummary</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">-0.2597831</td>
<td align="right">-0.2654204</td>
<td align="right">-0.428464</td>
<td align="right">-0.0882898</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME am</td>
</tr></tbody>
</table>
<p>Note that by default, <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code> uses the model frame from the model object as the dataset. This, however, can be overridden. You can give it any (valid) dataset and it will add or override the chosen values and average across the predictions from the different rows of the dataset.</p>
</div>
<div id="ames-for-poisson-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#ames-for-poisson-regression" class="anchor"></a>AMEs for Poisson Regression</h2>
<p>Here is a short example for Poisson regression used for count outcomes. We use a dataset drawn from: <a href="https://stats.idre.ucla.edu/r/dae/poisson-regression/" class="uri">https://stats.idre.ucla.edu/r/dae/poisson-regression/</a></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"https://stats.idre.ucla.edu/stat/data/poisson_sim.csv"</span><span class="op">)</span>
<span class="va">d</span><span class="op">[</span>, <span class="va">prog</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">prog</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>

<span class="va">bayes.poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>
  <span class="va">num_awards</span> <span class="op">~</span> <span class="va">prog</span> <span class="op">+</span> <span class="va">math</span>, data <span class="op">=</span> <span class="va">d</span>,
  family <span class="op">=</span> <span class="st">"poisson"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,
  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span>
<span class="co">#&gt; Compiling Stan program...</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bayes.poisson</span><span class="op">)</span>
<span class="co">#&gt;  Family: poisson </span>
<span class="co">#&gt;   Links: mu = log </span>
<span class="co">#&gt; Formula: num_awards ~ prog + math </span>
<span class="co">#&gt;    Data: d (Number of observations: 200) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 1000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept         -5.33      0.67    -6.70    -4.06 1.00     2202     1923</span>
<span class="co">#&gt; progAcademic       1.14      0.37     0.45     1.91 1.00     1957     2210</span>
<span class="co">#&gt; progVocational     0.38      0.45    -0.49     1.30 1.00     2114     1882</span>
<span class="co">#&gt; math               0.07      0.01     0.05     0.09 1.00     2238     2373</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>AME for a continuous variable, using default CI interval and type.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>
<span class="va">ame1.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.poisson</span>,
  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>math <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"AME math"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame1.p</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.044</td>
<td align="right">0.044</td>
<td align="right">0.025</td>
<td align="right">0.064</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME math</td>
</tr></tbody>
</table>
<p>AME for a categorical variable. Here we calculate pairwise contrasts for all three program types. These are the predicted number of awards.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ame2.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.poisson</span>,
  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    prog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,
                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
    <span class="st">"AME General v Academic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
    <span class="st">"AME General v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
    <span class="st">"AME Academic v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame2.p</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.263</td>
<td align="right">0.250</td>
<td align="right">0.080</td>
<td align="right">0.538</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.779</td>
<td align="right">0.776</td>
<td align="right">0.583</td>
<td align="right">0.996</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">0.377</td>
<td align="right">0.368</td>
<td align="right">0.133</td>
<td align="right">0.681</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame2.p</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.516</td>
<td align="right">-0.525</td>
<td align="right">-0.815</td>
<td align="right">-0.175</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Academic</td>
</tr>
<tr class="even">
<td align="right">-0.114</td>
<td align="right">-0.111</td>
<td align="right">-0.473</td>
<td align="right">0.244</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Vocational</td>
</tr>
<tr class="odd">
<td align="right">0.402</td>
<td align="right">0.409</td>
<td align="right">0.006</td>
<td align="right">0.726</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME Academic v Vocational</td>
</tr>
</tbody>
</table>
</div>
<div id="ames-for-negative-binomial-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#ames-for-negative-binomial-regression" class="anchor"></a>AMEs for Negative Binomial Regression</h2>
<p>Here is a short example for Negative Binomial regression used for count outcomes. We use the same setup as for the Poisson regression example.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://stats.idre.ucla.edu/stat/data/poisson_sim.csv"</span><span class="op">)</span>
<span class="va">d</span><span class="op">$</span><span class="va">prog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">prog</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span>

<span class="va">bayes.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span>
  <span class="va">num_awards</span> <span class="op">~</span> <span class="va">prog</span> <span class="op">+</span> <span class="va">math</span>, data <span class="op">=</span> <span class="va">d</span>,
  family <span class="op">=</span> <span class="st">"negbinomial"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,
  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span>
<span class="co">#&gt; Compiling Stan program...</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bayes.nb</span><span class="op">)</span>
<span class="co">#&gt;  Family: negbinomial </span>
<span class="co">#&gt;   Links: mu = log; shape = identity </span>
<span class="co">#&gt; Formula: num_awards ~ prog + math </span>
<span class="co">#&gt;    Data: d (Number of observations: 200) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 1000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept         -5.38      0.71    -6.79    -3.98 1.00     2747     2510</span>
<span class="co">#&gt; progAcademic       1.13      0.37     0.43     1.87 1.00     2565     2476</span>
<span class="co">#&gt; progVocational     0.38      0.47    -0.54     1.27 1.00     2547     2094</span>
<span class="co">#&gt; math               0.07      0.01     0.05     0.09 1.00     2846     2549</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; shape    20.34     37.45     1.95   115.92 1.00     2723     2398</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>AME for a continuous variable, using default CI interval and type.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>
<span class="va">ame1.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.nb</span>,
  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>math <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"AME math"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame1.nb</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.045</td>
<td align="right">0.045</td>
<td align="right">0.022</td>
<td align="right">0.069</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME math</td>
</tr></tbody>
</table>
<p>AME for a categorical variable. Here we calculate pairwise contrasts for all three program types. These are the predicted number of awards.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ame2.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.nb</span>,
  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    prog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,
                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
    <span class="st">"AME General v Academic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
    <span class="st">"AME General v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
    <span class="st">"AME Academic v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame2.nb</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.267</td>
<td align="right">0.255</td>
<td align="right">0.079</td>
<td align="right">0.561</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.779</td>
<td align="right">0.775</td>
<td align="right">0.579</td>
<td align="right">1.014</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">0.387</td>
<td align="right">0.375</td>
<td align="right">0.142</td>
<td align="right">0.728</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ame2.nb</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.512</td>
<td align="right">-0.517</td>
<td align="right">-0.847</td>
<td align="right">-0.161</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Academic</td>
</tr>
<tr class="even">
<td align="right">-0.120</td>
<td align="right">-0.117</td>
<td align="right">-0.524</td>
<td align="right">0.288</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Vocational</td>
</tr>
<tr class="odd">
<td align="right">0.391</td>
<td align="right">0.397</td>
<td align="right">-0.022</td>
<td align="right">0.748</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME Academic v Vocational</td>
</tr>
</tbody>
</table>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>These references may be useful.</p>
<ul>
<li>Norton, E. C., Dowd, B. E., &amp; Maciejewski, M. L. (2019). Marginal effects—quantifying the effect of changes in risk factors in logistic regression models. <em>JAMA, 321</em>(13), 1304-1305.</li>
<li>Mize, T. D., Doan, L., &amp; Long, J. S. (2019). A general framework for comparing predictions and marginal effects across models. <em>Sociological Methodology, 49</em>(1), 152-189.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua F. Wiley.</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1, using <a href="https://preferably.amirmasoudabdol.name/?source=footer">preferably</a> template.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
