<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. -->
<meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script>

<title>Calculate Average Marginal Effects (AMEs) from brms models — brmsmargins • brmsmargins</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- Flatly Theme - Light  -->
<link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">

<!-- Darkly Theme - Dark -->
<link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">

<!-- preferably CSS -->
<link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">


<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate Average Marginal Effects (AMEs) from brms models — brmsmargins" />
<meta property="og:description" content="This function is designed to help calculate average marginal
effects (AMEs) from brms models.
Currently, only one of at or add can be specified.
It is hoped to relax this in the future.
TODO add more documentation and technical definitions." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>




<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brmsmargins</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fixed-effects-marginaleffects.html">Marginal Effects for Fixed Effects Models</a>
    </li>
    <li>
      <a href="../articles/location-scale-marginaleffects.html">Marginal Effects for Location Scale Models</a>
    </li>
    <li>
      <a href="../articles/mixed-effects-marginaleffects.html">Marginal Effects for Mixed Effects Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
        <li>
  <a href="https://github.com/JWiley/brmsmargins/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Average Marginal Effects (AMEs) from brms models</h1>
    <small class="dont-index">Source: <a href='https://github.com/JWiley/brmsmargins/blob/master/R/margins.R'><code>R/margins.R</code></a></small>
    <div class="hidden name"><code>brmsmargins.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is designed to help calculate average marginal
effects (AMEs) from brms models.
Currently, only one of <code>at</code> or <code>add</code> can be specified.
It is hoped to relax this in the future.
TODO add more documentation and technical definitions.</p>
    </div>

    <pre class="usage"><span class='fu'>brmsmargins</span><span class='op'>(</span>
  <span class='va'>object</span>,
  at <span class='op'>=</span> <span class='cn'>NULL</span>,
  add <span class='op'>=</span> <span class='cn'>NULL</span>,
  newdata <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/model.frame.html'>model.frame</a></span><span class='op'>(</span><span class='va'>object</span><span class='op'>)</span>,
  CI <span class='op'>=</span> <span class='fl'>0.99</span>,
  CIType <span class='op'>=</span> <span class='st'>"HDI"</span>,
  contrasts <span class='op'>=</span> <span class='cn'>NULL</span>,
  ROPE <span class='op'>=</span> <span class='cn'>NULL</span>,
  MID <span class='op'>=</span> <span class='cn'>NULL</span>,
  subset <span class='op'>=</span> <span class='cn'>NULL</span>,
  dpar <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>seed</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>A fitted brms model object. Required.</p></td>
    </tr>
    <tr>
      <th>at</th>
      <td><p>An optional object inheriting from data frame indicating
the values to hold specific variables at when calculating average
predictions. This is intended for AMEs from categorical variables.</p></td>
    </tr>
    <tr>
      <th>add</th>
      <td><p>An optional object inheriting from data frame indicating
the values to add to specific variables at when calculating average
predictions. This is intended for AMEs for continuous variables.</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>An object inheriting from data frame indicating
the baseline values to use for predictions and AMEs.
Defaults to be the model frame.</p></td>
    </tr>
    <tr>
      <th>CI</th>
      <td><p>A numeric value specifying the width of the credible interval.
Defaults to <code>0.99</code>.</p></td>
    </tr>
    <tr>
      <th>CIType</th>
      <td><p>A character string specifying the type of credible interval
(e.g., highest density interval). It is passed down to
<code><a href='bsummary.html'>bsummary</a></code> which in turn passes it to
<code><a href='https://easystats.github.io/bayestestR/reference/ci.html'>ci</a></code>. Defaults to &#8220;HDI&#8221;.</p></td>
    </tr>
    <tr>
      <th>contrasts</th>
      <td><p>An optional contrast matrix. The posterior predictions matrix
is post multiplied by the contrast matrix, so they must be conformable.
The posterior predictions matrix has a separate column for each row in the
<code>at</code> or <code>add</code> object, so the contrast matrix should have the same
number of rows. It can have multiple columns, if you desire multiple specific
contrasts.</p></td>
    </tr>
    <tr>
      <th>ROPE</th>
      <td><p>Either left as <code>NULL</code>, the default, or a numeric vector of
length 2, specifying the lower and upper thresholds for the
Region of Practical Equivalence (ROPE).</p></td>
    </tr>
    <tr>
      <th>MID</th>
      <td><p>Either left as <code>NULL</code>, the default, or a numeric vector of
length 2, specifying the lower and upper thresholds for a
Minimally Important Difference (MID). Unlike the ROPE, percentages for
the MID are calculated as at or exceeding the bounds specified by this
argument, whereas the ROPE is the percentage of the posterior at or inside
the bounds specified.</p></td>
    </tr>
    <tr>
      <th>subset</th>
      <td><p>A character string that is a valid <code>R</code> expression
used to subset the dataset passed in <code>newdata</code>,
prior to analysis. Defaults to <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>dpar</th>
      <td><p>Parameter passed on the <code>dpar</code>
argument of <code><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted()</a></code> in brms. Defaults to <code>NULL</code>
indicating the mean or location parameter typically.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>Argument that controls whether (and if so what) random seed
to use. This does not matter when using fixed effects only. However,
when using Monte Carlo integration to integrate out random effects from
mixed effects models, it is critical if you are looking at a continuous
marginal effect with some small offset value as otherwise the
Monte Carlo error from one set of predictions to another may exceed
the true predicted difference.
If <code>seed</code> is left missing, the default, than a single, random integer
between +\- 1e7 is chosen and used to set the seed before each
prediction. If manually chosen (recommended for reproducibility),
the seed should either be a single value, in which case this single
value is used to set the seed before each prediction.
Alternately, it can be a vector of seeds with either the same length
as the number of rows in <code>at</code> or <code>add</code>, whichever was specified.
This is probably generally not what you want, as it means that even for
the same input data, you would get slightly different predictions
(when integrating out random effects) due to Monte Carlo variation.
Finally, rather than being missing, you can explicitly set
<code>seed = NULL</code>, if you do not want any seed to be set.
This would be fine, for instance, when only using fixed effects,
or if you know what you are doing and intend that behavior when
integrating out random effects.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed on to <code><a href='.predict.html'>.predict</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list. TODO describe more.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'><span class='co'>#### Testing ####</span></span>
<span class='r-in'><span class='co'>## sample data and logistic model with brms</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1234</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>Tx</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, each <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>ybin</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>40</span>,<span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>,<span class='fl'>40</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>logitd</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>Tx <span class='op'>=</span> <span class='va'>Tx</span>, ybin <span class='op'>=</span> <span class='va'>ybin</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>logitd</span><span class='op'>$</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>100</span>, mean <span class='op'>=</span> <span class='va'>logitd</span><span class='op'>$</span><span class='va'>ybin</span>, sd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>mbin</span> <span class='op'>&lt;-</span> <span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>ybin</span> <span class='op'>~</span> <span class='va'>Tx</span> <span class='op'>+</span> <span class='va'>x</span>, data <span class='op'>=</span> <span class='va'>logitd</span>, family <span class='op'>=</span> <span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsfamily.html'>bernoulli</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>mbin</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## predictions + summary</span></span>
<span class='r-in'><span class='va'>test1</span> <span class='op'>&lt;-</span> <span class='fu'>brmsmargins</span><span class='fu'>:::</span><span class='fu'><a href='.predict.html'>.predict</a></span><span class='op'>(</span><span class='va'>mbin</span>,</span>
<span class='r-in'>         <span class='fu'><a href='https://rdrr.io/r/stats/model.frame.html'>model.frame</a></span><span class='op'>(</span><span class='va'>mbin</span><span class='op'>)</span>,</span>
<span class='r-in'>         summarize <span class='op'>=</span> <span class='cn'>TRUE</span>, posterior <span class='op'>=</span> <span class='cn'>FALSE</span>, dpar <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span class='r-in'>         resample <span class='op'>=</span> <span class='fl'>0L</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>test1</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## check that bootstrapping the sample / population assumed as part of the</span></span>
<span class='r-in'><span class='co'>## AME indeed increases the uncertainty interval</span></span>
<span class='r-in'><span class='co'>## TODO: point estimates (M, Mdn) should be based on the actual data</span></span>
<span class='r-in'><span class='co'>## not the bootstrapped</span></span>
<span class='r-in'><span class='va'>test2</span> <span class='op'>&lt;-</span> <span class='fu'>brmsmargins</span><span class='fu'>:::</span><span class='fu'><a href='.predict.html'>.predict</a></span><span class='op'>(</span><span class='va'>mbin</span>,</span>
<span class='r-in'>         <span class='fu'><a href='https://rdrr.io/r/stats/model.frame.html'>model.frame</a></span><span class='op'>(</span><span class='va'>mbin</span><span class='op'>)</span>,</span>
<span class='r-in'>         summarize <span class='op'>=</span> <span class='cn'>TRUE</span>, posterior <span class='op'>=</span> <span class='cn'>FALSE</span>, dpar <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span class='r-in'>         resample <span class='op'>=</span> <span class='fl'>100L</span>, seed <span class='op'>=</span> <span class='fl'>1234</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>test2</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## now check AME for Tx</span></span>
<span class='r-in'><span class='va'>tmp</span> <span class='op'>&lt;-</span> <span class='fu'>brmsmargins</span><span class='op'>(</span></span>
<span class='r-in'>  object <span class='op'>=</span> <span class='va'>mbin</span>,</span>
<span class='r-in'>  at <span class='op'>=</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>Tx <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>,</span>
<span class='r-in'>  contrasts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,</span>
<span class='r-in'>  ROPE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.05</span>, <span class='op'>+</span><span class='fl'>.05</span><span class='op'>)</span>,</span>
<span class='r-in'>  MID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.10</span>, <span class='op'>+</span><span class='fl'>.10</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>tmp</span><span class='op'>$</span><span class='va'>Summary</span></span>
<span class='r-in'><span class='va'>tmp</span><span class='op'>$</span><span class='va'>ContrastSummary</span> <span class='co'>## Tx AME</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## now check AME for Tx with bootstrapping the AME population</span></span>
<span class='r-in'><span class='va'>tmpalt</span> <span class='op'>&lt;-</span> <span class='fu'>brmsmargins</span><span class='op'>(</span></span>
<span class='r-in'>  object <span class='op'>=</span> <span class='va'>mbin</span>,</span>
<span class='r-in'>  at <span class='op'>=</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>Tx <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>,</span>
<span class='r-in'>  contrasts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,</span>
<span class='r-in'>  ROPE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.05</span>, <span class='op'>+</span><span class='fl'>.05</span><span class='op'>)</span>,</span>
<span class='r-in'>  MID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.10</span>, <span class='op'>+</span><span class='fl'>.10</span><span class='op'>)</span>,</span>
<span class='r-in'>  resample <span class='op'>=</span> <span class='fl'>100L</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>tmpalt</span><span class='op'>$</span><span class='va'>Summary</span></span>
<span class='r-in'><span class='va'>tmpalt</span><span class='op'>$</span><span class='va'>ContrastSummary</span> <span class='co'>## Tx AME</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## now check AME for continuous predictor, x</span></span>
<span class='r-in'><span class='co'>## use .01 as an approximation for first derivative</span></span>
<span class='r-in'><span class='co'>## 1 / .01 in the contrast matrix to get back to a one unit change metric</span></span>
<span class='r-in'><span class='va'>tmp2</span> <span class='op'>&lt;-</span> <span class='fu'>brmsmargins</span><span class='op'>(</span></span>
<span class='r-in'>  object <span class='op'>=</span> <span class='va'>mbin</span>,</span>
<span class='r-in'>  add <span class='op'>=</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>.01</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span class='r-in'>  contrasts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>/</span><span class='fl'>.01</span>, <span class='fl'>1</span><span class='op'>/</span><span class='fl'>.01</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,</span>
<span class='r-in'>  ROPE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.05</span>, <span class='op'>+</span><span class='fl'>.05</span><span class='op'>)</span>,</span>
<span class='r-in'>  MID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.10</span>, <span class='op'>+</span><span class='fl'>.10</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>tmp2</span><span class='op'>$</span><span class='va'>ContrastSummary</span> <span class='co'>## x AME</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/lme4/lme4/'>lme4</a></span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>sleepstudy</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>Reaction</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>Days</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span><span class='op'>+</span> <span class='va'>Days</span> <span class='op'>|</span> <span class='va'>Subject</span><span class='op'>)</span>,</span>
<span class='r-in'>             data <span class='op'>=</span> <span class='va'>sleepstudy</span>,</span>
<span class='r-in'>             cores <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fit</span>, prob <span class='op'>=</span> <span class='fl'>0.99</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='va'>tmp</span> <span class='op'>&lt;-</span> <span class='fu'>brmsmargins</span><span class='op'>(</span></span>
<span class='r-in'>    object <span class='op'>=</span> <span class='va'>fit</span>,</span>
<span class='r-in'>    at <span class='op'>=</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>Days <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>,</span>
<span class='r-in'>    contrasts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,</span>
<span class='r-in'>    ROPE <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.05</span>, <span class='op'>+</span><span class='fl'>.05</span><span class='op'>)</span>,</span>
<span class='r-in'>    MID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>.10</span>, <span class='op'>+</span><span class='fl'>.10</span><span class='op'>)</span>, CIType <span class='op'>=</span> <span class='st'>"ETI"</span>, effects <span class='op'>=</span> <span class='st'>"integrateoutRE"</span>, k <span class='op'>=</span> <span class='fl'>5L</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='va'>tmp</span><span class='op'>$</span><span class='va'>Summary</span></span>
<span class='r-in'>  <span class='va'>tmp</span><span class='op'>$</span><span class='va'>ContrastSummary</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'><span class='op'>}</span></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joshua F. Wiley.</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1, using <a href="https://preferably.amirmasoudabdol.name/?source=footer">preferably</a> template.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


