<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Marginal Effects from 'brms' Models — brmsmargins • brmsmargins</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Marginal Effects from 'brms' Models — brmsmargins"><meta name="description" content="This function is designed to help calculate marginal effects
including average marginal effects (AMEs) from brms models.
Arguments are labeled as required when it is required that the
user directly specify the argument. Arguments are labeled as
optional when either the argument is optional or there are
sensible default values so that users do not typically need to specify
the argument."><meta property="og:description" content="This function is designed to help calculate marginal effects
including average marginal effects (AMEs) from brms models.
Arguments are labeled as required when it is required that the
user directly specify the argument. Arguments are labeled as
optional when either the argument is optional or there are
sensible default values so that users do not typically need to specify
the argument."><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@WileyResearch"><meta name="twitter:site" content="https://joshuawiley.com"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brmsmargins</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fixed-effects-marginaleffects.html">Marginal Effects for Fixed Effects Models</a></li>
    <li><a class="dropdown-item" href="../articles/mixed-effects-marginaleffects.html">Marginal Effects for Mixed Effects Models</a></li>
    <li><a class="dropdown-item" href="../articles/location-scale-marginaleffects.html">Marginal Effects for Location Scale Models</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JWiley/brmsmargins/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Marginal Effects from 'brms' Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/JWiley/brmsmargins/blob/main/R/margins.R" class="external-link"><code>R/margins.R</code></a></small>
      <div class="d-none name"><code>brmsmargins.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is designed to help calculate marginal effects
including average marginal effects (AMEs) from <code>brms</code> models.
Arguments are labeled as <em>required</em> when it is required that the
user directly specify the argument. Arguments are labeled as
<em>optional</em> when either the argument is optional or there are
sensible default values so that users do not typically need to specify
the argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">brmsmargins</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  at <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  wat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  CIType <span class="op">=</span> <span class="st">"HDI"</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ROPE <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  MID <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dpar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">seed</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A <em>required</em> argument specifying a fitted <code>brms</code> model object.</p></dd>


<dt id="arg-at">at<a class="anchor" aria-label="anchor" href="#arg-at"></a></dt>
<dd><p>An <em>optional</em> argument (but note, either <code>at</code> or <code>add</code> are
<em>required</em>) specifying an object inheriting from data frame indicating
the values to hold specific variables at when calculating average
predictions. This is intended for AMEs from categorical variables.</p></dd>


<dt id="arg-wat">wat<a class="anchor" aria-label="anchor" href="#arg-wat"></a></dt>
<dd><p>An <em>optional</em> list with named elements including one element named,
"ID" with a single character string, the name of the variable
in the model frame that is the ID variable. Additionally,
there should be one or more named elements, named after variables
in the model (and specified in the <code>at</code> argument), that
contain a <code>data.table</code> or <code>data.frame</code> with three
variables: (1) the ID variable giving IDs, (2) the values
specified for the variable in the <code>at</code> argument, and
(3) the actual values to be substituted for each ID.
<code>wat</code> cannot be non null unless <code>at</code> also is non null.</p></dd>


<dt id="arg-add">add<a class="anchor" aria-label="anchor" href="#arg-add"></a></dt>
<dd><p>An <em>optional</em> argument (but note, either <code>at</code> or <code>add</code> are
<em>required</em>) specifying an object inheriting from data frame indicating
the values to add to specific variables at when calculating average
predictions. This is intended for AMEs for continuous variables.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>An <em>optional</em> argument specifying an object inheriting
from data frame indicating the baseline values to use for predictions and AMEs.
It uses a sensible default: the model frame from the <code>brms</code>
model object passed on the <code>object</code> argument.</p></dd>


<dt id="arg-ci">CI<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>An <em>optional</em> argument with a numeric value specifying the width
of the credible interval. Defaults to <code>0.99</code>. This default is arbitrary,
but is purposefully higher than the common <code>0.95</code> to encourage science
with greater acknowledgment of uncertainty or larger sample sizes (ideally).</p></dd>


<dt id="arg-citype">CIType<a class="anchor" aria-label="anchor" href="#arg-citype"></a></dt>
<dd><p>An <em>optional</em> argument, a character string specifying the
type of credible interval (e.g., highest density interval). It is passed down to
<code><a href="bsummary.html">bsummary()</a></code> which in turn passes it to
<code><a href="https://easystats.github.io/bayestestR/reference/ci.html" class="external-link">bayestestR::ci()</a></code>. Defaults to "HDI".</p></dd>


<dt id="arg-contrasts">contrasts<a class="anchor" aria-label="anchor" href="#arg-contrasts"></a></dt>
<dd><p>An <em>optional</em> argument specifying a contrast matrix.
The posterior predictions matrix
is post multiplied by the contrast matrix, so they must be conformable.
The posterior predictions matrix has a separate column for each row in the
<code>at</code> or <code>add</code> object, so the contrast matrix should have the same
number of rows. It can have multiple columns, if you desire multiple specific
contrasts.</p></dd>


<dt id="arg-rope">ROPE<a class="anchor" aria-label="anchor" href="#arg-rope"></a></dt>
<dd><p>An <em>optional</em> argument, that can either be left as <code>NULL</code>,
the default, or a numeric vector of length 2, specifying the
lower and upper thresholds for the
Region of Practical Equivalence (ROPE).</p></dd>


<dt id="arg-mid">MID<a class="anchor" aria-label="anchor" href="#arg-mid"></a></dt>
<dd><p>An <em>optional</em> argument, that can either left as <code>NULL</code>,
the default, or a numeric vector of length 2, specifying the
lower and upper thresholds for a
Minimally Important Difference (MID). Unlike the ROPE, percentages for
the MID are calculated as at or exceeding the bounds specified by this
argument, whereas the ROPE is the percentage of the posterior at or inside
the bounds specified.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>An <em>optional</em> argument, a character string that is a
valid <code>R</code> expression used to subset the dataset passed in <code>newdata</code>,
prior to analysis. Defaults to <code>NULL</code>.</p></dd>


<dt id="arg-dpar">dpar<a class="anchor" aria-label="anchor" href="#arg-dpar"></a></dt>
<dd><p>An <em>optional</em> argument giving the parameter passed on to the <code>dpar</code>
argument of <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> in brms. Defaults to <code>NULL</code>,
indicating the mean or location parameter typically.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An <em>optional</em> argument that controls whether (and if so what) random seed
to use. This does not matter when using fixed effects only. However,
when using Monte Carlo integration to integrate out random effects from
mixed effects models, it is critical if you are looking at a continuous
marginal effect with some small offset value as otherwise the
Monte Carlo error from one set of predictions to another may exceed
the true predicted difference.
If <code>seed</code> is left missing, the default, than a single, random integer
between +\- 1e7 is chosen and used to set the seed before each
prediction. If manually chosen (recommended for reproducibility),
the seed should either be a single value, in which case this single
value is used to set the seed before each prediction.
Alternately, it can be a vector of seeds with either the same length
as the number of rows in <code>at</code> or <code>add</code>, whichever was specified.
This is probably generally not what you want, as it means that even for
the same input data, you would get slightly different predictions
(when integrating out random effects) due to Monte Carlo variation.
Finally, rather than being missing, you can explicitly set
<code>seed = NULL</code>, if you do not want any seed to be set.
This would be fine, for instance, when only using fixed effects,
or if you know what you are doing and intend that behavior when
integrating out random effects.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>An <em>optional</em> argument, a logical value whether to print
more verbose messages. Defaults to <code>FALSE</code> which is quieter. Set to
<code>TRUE</code> for more messages to be printed where relevant.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>An <em>optional</em> argument, additional arguments passed on to
<code><a href="prediction.html">prediction()</a></code>. In particular, the <code>effects</code> argument of <code><a href="prediction.html">prediction()</a></code>
is important for mixed effects models to control how random effects
are treated in the predictions, which subsequently changes the
marginal effect estimates.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with four elements.</p><ul><li><p><code>Posterior</code> Posterior distribution of all predictions. These predictions default to fixed effects only, but by specifying options to
<code><a href="prediction.html">prediction()</a></code> they can include random effects or be predictions integrating out random effects.</p></li>
<li><p><code>Summary</code> A summary of the predictions.</p></li>
<li><p><code>Contrasts</code> Posterior distribution of all contrasts, if a contrast matrix was specified.</p></li>
<li><p><code>ContrastSummary</code> A summary of the posterior distribution of all contrasts, if specified</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The main parts required for the function are a fitted model object,
(via the <code>object</code> argument) a dataset to be used for prediction,
(via the <code>newdata</code> argument which defaults to the model frame),
and a dataset passed to either <code>at</code> or <code>add</code>.
The steps are as follows:</p><ol><li><p>Check that the function inputs (model object, data, etc.) are valid.</p></li>
<li><p>Take the dataset from the <code>newdata</code> argument and either
add the values from the first row of <code>add</code> or replace the values
using the first row of <code>at</code>. Only variables specified in
<code>at</code> or <code>add</code> are modified. Other variables are left as is.</p></li>
<li><p>Use the <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> function to generate predictions based on
this modified dataset. If <code>effects</code> is set to "fixedonly"
(meaning only generate predictions using fixed effects)
or to "includeRE"
(meaning generate predictions using fixed and random effects),
then predictions are generated entirely using the <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>
function and are, typically back transformed to the response scale.
For mixed effects models with fixed and random effects where
<code>effects</code> is set to "integrateoutRE", then <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>
is only used to generate predictions using the fixed effects on the linear
scale. For each prediction generated, the random effects are integrated out
by drawing <code>k</code> random samples from the model assumed random effect(s)
distribution. These are added to the fixed effects predictions,
back transformed, and then averaged over all <code>k</code> random samples to
perform numerical Monte Carlo integration.</p></li>
<li><p>All the predictions for each posterior draw, after any back transformation
has been applied, are averaged, resulting in one, marginal value for each
posterior draw. These are marginal predictions. They are average marginal
predictions if averaging over the sample dataset, or may be marginal predictions
at the means, if the initial input dataset used mean values, etc.</p></li>
<li><p>Steps two to four are repeated for each row of <code>at</code> or <code>add</code>.
Results are combined into a matrix where the columns are different
rows from <code>at</code> or <code>add</code> and the rows are different posterior
draws.</p></li>
<li><p>If contrasts were specified, using a contrast matrix, the
marginal prediction matrix is post multiplied by the contrast matrix.
Depending on the choice(s) of <code>add</code> or <code>at</code> and the
values in the contrast matrix, these can then be
average marginal effects (AMEs) by using numerical integration
(<code>add</code> with 0 and a very close to 0 value) or
discrete difference (<code>at</code> with say 0 and 1 as values)
for a given predictor(s).</p></li>
<li><p>The marginal predictions and the contrasts, if specified are
summarized.</p></li>
</ol><p>Although <code>brmsmargins()</code> is focused on helping to calculate
marginal effects, it can also be used to generate marginal predictions,
and indeed these marginal predictions are the foundation of any
marginal effect estimates. Through manipulating the input data,
<code>at</code> or <code>add</code> and the contrast matrix, other types of estimates
averaged or weighting results in specific ways are also possible.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Pavlou, M., Ambler, G., Seaman, S., &amp; Omar, R. Z. (2015)
<a href="https://doi.org/10.1186/s12874-015-0046-6" class="external-link">doi:10.1186/s12874-015-0046-6</a>

“A note on obtaining correct marginal predictions from a random intercepts model for binary outcomes”
and
Skrondal, A., &amp; Rabe-Hesketh, S. (2009)
<a href="https://doi.org/10.1111/j.1467-985X.2009.00587.x" class="external-link">doi:10.1111/j.1467-985X.2009.00587.x</a>

“Prediction in multilevel generalized linear models”
and
Norton EC, Dowd BE, Maciejewski ML. (2019)
<a href="https://doi.org/10.1001/jama.2019.1954" class="external-link">doi:10.1001/jama.2019.1954</a>

“Marginal Effects—Quantifying the Effect of Changes in Risk Factors in Logistic Regression Models”</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#### Testing ####</span></span></span>
<span class="r-in"><span><span class="co">## sample data and logistic model with brms</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Tx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, each <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ybin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">logitd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Tx <span class="op">=</span> <span class="va">Tx</span>, ybin <span class="op">=</span> <span class="va">ybin</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">logitd</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, mean <span class="op">=</span> <span class="va">logitd</span><span class="op">$</span><span class="va">ybin</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mbin</span> <span class="op">&lt;-</span> <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">ybin</span> <span class="op">~</span> <span class="va">Tx</span> <span class="op">+</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">logitd</span>, family <span class="op">=</span> <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">bernoulli</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbin</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now check AME for Tx</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">brmsmargins</span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">mbin</span>,</span></span>
<span class="r-in"><span>  at <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>Tx <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ROPE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>, <span class="op">+</span><span class="fl">.05</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  MID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.10</span>, <span class="op">+</span><span class="fl">.10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp</span><span class="op">$</span><span class="va">Summary</span></span></span>
<span class="r-in"><span><span class="va">tmp</span><span class="op">$</span><span class="va">ContrastSummary</span> <span class="co">## Tx AME</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now check AME for Tx with bootstrapping the AME population</span></span></span>
<span class="r-in"><span><span class="va">tmpalt</span> <span class="op">&lt;-</span> <span class="fu">brmsmargins</span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">mbin</span>,</span></span>
<span class="r-in"><span>  at <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>Tx <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ROPE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>, <span class="op">+</span><span class="fl">.05</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  MID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.10</span>, <span class="op">+</span><span class="fl">.10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  resample <span class="op">=</span> <span class="fl">100L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmpalt</span><span class="op">$</span><span class="va">Summary</span></span></span>
<span class="r-in"><span><span class="va">tmpalt</span><span class="op">$</span><span class="va">ContrastSummary</span> <span class="co">## Tx AME</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now check AME for continuous predictor, x</span></span></span>
<span class="r-in"><span><span class="co">## use .01 as an approximation for first derivative</span></span></span>
<span class="r-in"><span><span class="co">## 1 / .01 in the contrast matrix to get back to a one unit change metric</span></span></span>
<span class="r-in"><span><span class="va">tmp2</span> <span class="op">&lt;-</span> <span class="fu">brmsmargins</span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">mbin</span>,</span></span>
<span class="r-in"><span>  add <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.01</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">.01</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">.01</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ROPE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>, <span class="op">+</span><span class="fl">.05</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  MID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.10</span>, <span class="op">+</span><span class="fl">.10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp2</span><span class="op">$</span><span class="va">ContrastSummary</span> <span class="co">## x AME</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="va">sleepstudy</span>,</span></span>
<span class="r-in"><span>             cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, prob <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">brmsmargins</span><span class="op">(</span></span></span>
<span class="r-in"><span>    object <span class="op">=</span> <span class="va">fit</span>,</span></span>
<span class="r-in"><span>    at <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>Days <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    ROPE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>, <span class="op">+</span><span class="fl">.05</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    MID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.10</span>, <span class="op">+</span><span class="fl">.10</span><span class="op">)</span>, CIType <span class="op">=</span> <span class="st">"ETI"</span>, effects <span class="op">=</span> <span class="st">"integrateoutRE"</span>, k <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">tmp</span><span class="op">$</span><span class="va">Summary</span></span></span>
<span class="r-in"><span>  <span class="va">tmp</span><span class="op">$</span><span class="va">ContrastSummary</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://joshuawiley.com" class="external-link">Joshua F. Wiley</a>, Donald Hedeker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

