<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Marginal Effects for Fixed Effects Models • brmsmargins</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Marginal Effects for Fixed Effects Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brmsmargins</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fixed-effects-marginaleffects.html">Marginal Effects for Fixed Effects Models</a></li>
    <li><a class="dropdown-item" href="../articles/mixed-effects-marginaleffects.html">Marginal Effects for Mixed Effects Models</a></li>
    <li><a class="dropdown-item" href="../articles/location-scale-marginaleffects.html">Marginal Effects for Location Scale Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JWiley/brmsmargins/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Marginal Effects for Fixed Effects Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JWiley/brmsmargins/blob/main/vignettes/fixed-effects-marginaleffects.Rmd" class="external-link"><code>vignettes/fixed-effects-marginaleffects.Rmd</code></a></small>
      <div class="d-none name"><code>fixed-effects-marginaleffects.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; data.table 1.16.4 using 16 threads (see ?getDTthreads).  Latest news: r-datatable.com</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Rcpp</span></span>
<span><span class="co">#&gt; Loading 'brms' package (version 2.22.0). Useful instructions</span></span>
<span><span class="co">#&gt; can be found by typing help('brms'). A more detailed introduction</span></span>
<span><span class="co">#&gt; to the package is available through vignette('brms_overview').</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'brms'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ar</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joshuawiley.com/brmsmargins/">brmsmargins</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette provides a brief overview of how to calculate marginal
effects for Bayesian regression models involving only fixed effects and
fit using the <code>brms</code> package.</p>
<div class="section level2">
<h2 id="what-are-marginal-effects">What are marginal effects?<a class="anchor" aria-label="anchor" href="#what-are-marginal-effects"></a>
</h2>
<p>Marginal effects can be used to describe how an outcome is predicted
to change with a change in a predictor (or predictors). It is a
derivative. For convenience, typically calculated numerically rather
than analytically.</p>
<p>To motivate marginal effects, we can look at some regression models
fit in a frequentist framework for simplicity and speed. Here we use the
<code>mtcars</code> dataset built into <code>R</code>. First, we can
look at a linear regression model of the association between
<code>mpg</code> and <code>hp</code>. Here we can see the estimated
regression coefficient for <code>mpg</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">hp</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m.linear</span><span class="op">)</span><span class="op">[</span><span class="st">"mpg"</span><span class="op">]</span></span>
<span><span class="co">#&gt;       mpg </span></span>
<span><span class="co">#&gt; -11.19988</span></span></code></pre></div>
<p>In linear models with no interactions, no (non linear)
transformations, and a linear link function, the regression coefficient
is the predicted change in the outcome for a one unit change in the
predictor, regardless of any other values. For example, here we can look
at the predicted difference in the outcome for a one unit difference in
<code>mpg</code> from 0 to 1, holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.linear</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span></span>
<span><span class="co">#&gt;         2 </span></span>
<span><span class="co">#&gt; -11.19988</span></span></code></pre></div>
<p>We can look at the same estimate but moving <code>mpg</code> from 10
to 11 instead 0 to 1, holding <code>am = 1</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.linear</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">1</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span></span>
<span><span class="co">#&gt;         2 </span></span>
<span><span class="co">#&gt; -11.19988</span></span></code></pre></div>
<p>All of these quantities are identical. In this case, the regression
coefficient can be interpreted as a marginal effect: the expected change
in the outcome for a one unit shift in <code>mpg</code>, regardless of
the value of <code>am</code> and regardless of the values where
<code>mpg</code> is evaluated.</p>
<p>This convenient property does not hold for many types of models. Next
consider a logistic regression model. The regression coefficient, shown
below, is on the log odds scale, not the probability scale. This is not
convenient for interpretation, as the log odds scale is not the same
scale as our outcome.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span><span class="op">[</span><span class="st">"mpg"</span><span class="op">]</span></span>
<span><span class="co">#&gt;       mpg </span></span>
<span><span class="co">#&gt; 0.6809205</span></span></code></pre></div>
<p>We can find predicted differences on the probability scale. Here
moving <code>mpg</code> from 10 to 11 holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.logistic</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span></span>
<span><span class="co">#&gt;           2 </span></span>
<span><span class="co">#&gt; 0.002661989</span></span></code></pre></div>
<p>We can look at the same estimate but moving <code>mpg</code> from 20
to 21 instead 10 to 11 again holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.logistic</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span></span>
<span><span class="co">#&gt;         2 </span></span>
<span><span class="co">#&gt; 0.1175344</span></span></code></pre></div>
<p>We can look at the same estimate moving <code>mpg</code> from 20 to
21 as before, but this time holding <code>am = 1</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.logistic</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">1</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span></span>
<span><span class="co">#&gt;          2 </span></span>
<span><span class="co">#&gt; 0.08606869</span></span></code></pre></div>
<p>All the estimates in this case differ. The association between
<code>mpg</code> and <strong>probability</strong> of <code>vs</code> is
not linear. Marginal effects provide a way to get results on the
response scale, which can aid interpretation.</p>
<p>A common type of marginal effect is an average marginal effect (AME).
To calculate an AME numerically, we can get predicted probabilities from
a model for every observation in the dataset. For continuous variables,
we might use a very small difference to approximate the derivative. For
categorical variables, we might calculate a discrete difference.</p>
<div class="section level3">
<h3 id="average-marginal-effect-ame">Average Marginal Effect (AME)<a class="anchor" aria-label="anchor" href="#average-marginal-effect-ame"></a>
</h3>
<p>Here is an example of a continuous AME. <code>h</code> is a value
near to zero used for the numerical derivative. We take all the values
observed in the dataset for the first set of predicted probabilities.
Then we take the observed values + <code>h</code> and calculate new
predicted probabilities. The difference, divided by <code>h</code> is
the “instantaneous” (i.e., derivative) on the probability scale for a
one unit shift in the predictor, <code>mpg</code>, for each person. When
we average all of these, we get the AME.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span></span>
<span></span>
<span><span class="va">nd.1</span> <span class="op">&lt;-</span> <span class="va">nd.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span></span>
<span><span class="va">nd.1</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="va">nd.1</span><span class="op">$</span><span class="va">mpg</span> <span class="op">+</span> <span class="va">h</span></span>
<span></span>
<span><span class="va">yhat.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.logistic</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">nd.0</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yhat.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.logistic</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">nd.1</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">yhat.1</span> <span class="op">-</span> <span class="va">yhat.0</span><span class="op">)</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.06922997</span></span></code></pre></div>
<p>Here is an example of a discrete AME. The variable, <code>am</code>
only takes two values: 0 or 1. So we calculate predicted probabilities
if everyone had <code>am = 0</code> and then again if everyone had
<code>am = 1</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd.1</span> <span class="op">&lt;-</span> <span class="va">nd.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span></span>
<span><span class="va">nd.0</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">nd.1</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">yhat.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.logistic</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">nd.0</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yhat.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">m.logistic</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">nd.1</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">yhat.1</span> <span class="op">-</span> <span class="va">yhat.0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.2618203</span></span></code></pre></div>
<p>In both these examples, we are averaging across the different values
observed in the dataset. In a frequentist framework, additional details
are needed to calculate uncertainty intervals. In a Bayesian framework,
uncertainty intervals can be calculated readily by summarizing the
posterior.</p>
</div>
</div>
<div class="section level2">
<h2 id="ames-for-logistic-regression">AMEs for Logistic Regression<a class="anchor" aria-label="anchor" href="#ames-for-logistic-regression"></a>
</h2>
<p>The main function for users to use is <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code>.
Here is an example calculating AMEs for <code>mpg</code> and
<code>am</code>. First we will fit the same logistic regression model
using <code>brms</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayes.logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">vs</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"bernoulli"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: rstan</span></span>
<span><span class="co">#&gt; Loading required package: StanHeaders</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; rstan version 2.32.6 (Stan version 2.32.2)</span></span>
<span><span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt; options(mc.cores = parallel::detectCores()).</span></span>
<span><span class="co">#&gt; To avoid recompilation of unchanged Stan programs, we recommend calling</span></span>
<span><span class="co">#&gt; rstan_options(auto_write = TRUE)</span></span>
<span><span class="co">#&gt; For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span></span>
<span><span class="co">#&gt; change `threads_per_chain` option:</span></span>
<span><span class="co">#&gt; rstan_options(threads_per_chain = 1)</span></span>
<span><span class="co">#&gt; Do not specify '-march=native' in 'LOCAL_CPPFLAGS' or a Makevars file</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayes.logistic</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: bernoulli </span></span>
<span><span class="co">#&gt;   Links: mu = logit </span></span>
<span><span class="co">#&gt; Formula: vs ~ am + mpg </span></span>
<span><span class="co">#&gt;    Data: mtcars (Number of observations: 32) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 4000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept   -16.12      5.67   -28.84    -7.42 1.00     1379     1959</span></span>
<span><span class="co">#&gt; am           -3.83      1.86    -7.97    -0.70 1.00     1568     1772</span></span>
<span><span class="co">#&gt; mpg           0.87      0.31     0.40     1.56 1.00     1328     1711</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>Now we can use <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code>. We give it the model
object, a <code>data.frame</code> of the values to be added, first 0,
then (0 + h), and a contrast matrix. The default is a 99 percent
credible interval, which we override here to 0.95. We use highest
density intervals, which are the default. We also could have selected
“ETI” for equal tail intervals. <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code> will return a
list with the posterior of each prediction, a summary of the posterior
for the predictions, the posterior for the contrasts, and a summary of
the posterior for the contrasts. Here we just have the one contrast, but
multiple could have been specified.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span></span>
<span><span class="va">ame1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span></span>
<span>  <span class="va">bayes.logistic</span>,</span>
<span>  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME MPG"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">0.95</span>, CIType <span class="op">=</span> <span class="st">"HDI"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame1</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="6%">
<col width="8%">
<col width="8%">
<col width="16%">
<col width="14%">
<col width="6%">
<col width="9%">
<col width="6%">
<col width="5%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.071</td>
<td align="right">0.07</td>
<td align="right">0.054</td>
<td align="right">0.092</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME MPG</td>
</tr></tbody>
</table>
<p>Now we can look at how we could calculate a discrete AME. This time
we use the <code>at</code> argument instead of the <code>add</code>
argument as we want to hold <code>am</code> at specific values, not add
0 and 1 to the observed <code>am</code> values. Because 0 and 1 are
meaningful values of <code>am</code>, we also look at the summary of the
posterior for the predictions. These predictions average across all
values of <code>mpg</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ame2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span></span>
<span>  <span class="va">bayes.logistic</span>,</span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME am"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">0.95</span>, CIType <span class="op">=</span> <span class="st">"HDI"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="17%">
<col width="16%">
<col width="7%">
<col width="10%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.544</td>
<td align="right">0.547</td>
<td align="right">0.430</td>
<td align="right">0.662</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.283</td>
<td align="right">0.277</td>
<td align="right">0.175</td>
<td align="right">0.408</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2</span><span class="op">$</span><span class="va">ContrastSummary</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="12%">
<col width="11%">
<col width="5%">
<col width="7%">
<col width="5%">
<col width="4%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">-0.2607899</td>
<td align="right">-0.2649507</td>
<td align="right">-0.4289198</td>
<td align="right">-0.0891496</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME am</td>
</tr></tbody>
</table>
<p>Note that by default, <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code> uses the model frame
from the model object as the dataset. This, however, can be overridden.
You can give it any (valid) dataset and it will add or override the
chosen values and average across the predictions from the different rows
of the dataset.</p>
</div>
<div class="section level2">
<h2 id="ames-for-poisson-regression">AMEs for Poisson Regression<a class="anchor" aria-label="anchor" href="#ames-for-poisson-regression"></a>
</h2>
<p>Here is a short example for Poisson regression used for count
outcomes. We use a dataset drawn from: <a href="https://stats.oarc.ucla.edu/r/dae/poisson-regression/" class="external-link uri">https://stats.oarc.ucla.edu/r/dae/poisson-regression/</a></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"https://stats.oarc.ucla.edu/stat/data/poisson_sim.csv"</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">[</span>, <span class="va">prog</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">prog</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">bayes.poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">num_awards</span> <span class="op">~</span> <span class="va">prog</span> <span class="op">+</span> <span class="va">math</span>, data <span class="op">=</span> <span class="va">d</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayes.poisson</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: poisson </span></span>
<span><span class="co">#&gt;   Links: mu = log </span></span>
<span><span class="co">#&gt; Formula: num_awards ~ prog + math </span></span>
<span><span class="co">#&gt;    Data: d (Number of observations: 200) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 4000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept         -5.32      0.68    -6.68    -4.01 1.00     2444     2292</span></span>
<span><span class="co">#&gt; progAcademic       1.15      0.38     0.48     1.92 1.00     1949     1571</span></span>
<span><span class="co">#&gt; progVocational     0.39      0.47    -0.48     1.34 1.00     1808     1427</span></span>
<span><span class="co">#&gt; math               0.07      0.01     0.05     0.09 1.00     2729     2349</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>AME for a continuous variable, using default CI interval and
type.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span></span>
<span><span class="va">ame1.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span></span>
<span>  <span class="va">bayes.poisson</span>,</span>
<span>  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>math <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME math"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame1.p</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="15%">
<col width="14%">
<col width="6%">
<col width="9%">
<col width="6%">
<col width="5%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.044</td>
<td align="right">0.044</td>
<td align="right">0.025</td>
<td align="right">0.065</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME math</td>
</tr></tbody>
</table>
<p>AME for a categorical variable. Here we calculate pairwise contrasts
for all three program types. These are the predicted number of
awards.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ame2.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span></span>
<span>  <span class="va">bayes.poisson</span>,</span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    prog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    <span class="st">"AME General v Academic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="st">"AME General v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="st">"AME Academic v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.p</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="17%">
<col width="16%">
<col width="7%">
<col width="10%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.262</td>
<td align="right">0.253</td>
<td align="right">0.077</td>
<td align="right">0.522</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.780</td>
<td align="right">0.776</td>
<td align="right">0.575</td>
<td align="right">0.992</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">0.380</td>
<td align="right">0.368</td>
<td align="right">0.158</td>
<td align="right">0.707</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.p</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="12%">
<col width="11%">
<col width="5%">
<col width="7%">
<col width="5%">
<col width="4%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.518</td>
<td align="right">-0.522</td>
<td align="right">-0.806</td>
<td align="right">-0.135</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Academic</td>
</tr>
<tr class="even">
<td align="right">-0.118</td>
<td align="right">-0.115</td>
<td align="right">-0.510</td>
<td align="right">0.248</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Vocational</td>
</tr>
<tr class="odd">
<td align="right">0.400</td>
<td align="right">0.409</td>
<td align="right">0.011</td>
<td align="right">0.759</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME Academic v Vocational</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="ames-for-negative-binomial-regression">AMEs for Negative Binomial Regression<a class="anchor" aria-label="anchor" href="#ames-for-negative-binomial-regression"></a>
</h2>
<p>Here is a short example for Negative Binomial regression used for
count outcomes. We use the same setup as for the Poisson regression
example.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://stats.oarc.ucla.edu/stat/data/poisson_sim.csv"</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">prog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">prog</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bayes.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">num_awards</span> <span class="op">~</span> <span class="va">prog</span> <span class="op">+</span> <span class="va">math</span>, data <span class="op">=</span> <span class="va">d</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"negbinomial"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: 569 of 4000 (14.0%) transitions ended with a divergence.</span></span>
<span><span class="co">#&gt; See https://mc-stan.org/misc/warnings for details.</span></span>
<span><span class="co">#&gt; Warning: 3431 of 4000 (86.0%) transitions hit the maximum treedepth limit of 10.</span></span>
<span><span class="co">#&gt; See https://mc-stan.org/misc/warnings for details.</span></span>
<span><span class="co">#&gt; Warning: 2 of 4 chains have a NaN E-BFMI.</span></span>
<span><span class="co">#&gt; See https://mc-stan.org/misc/warnings for details.</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayes.nb</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be</span></span>
<span><span class="co">#&gt; careful when analysing the results! We recommend running more iterations and/or</span></span>
<span><span class="co">#&gt; setting stronger priors.</span></span>
<span><span class="co">#&gt; Warning: There were 569 divergent transitions after warmup. Increasing</span></span>
<span><span class="co">#&gt; adapt_delta above 0.8 may help. See</span></span>
<span><span class="co">#&gt; http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt;  Family: negbinomial </span></span>
<span><span class="co">#&gt;   Links: mu = log; shape = identity </span></span>
<span><span class="co">#&gt; Formula: num_awards ~ prog + math </span></span>
<span><span class="co">#&gt;    Data: d (Number of observations: 200) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 4000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept         -7.43      2.17    -9.81    -5.00  Inf        4       NA</span></span>
<span><span class="co">#&gt; progAcademic       2.68      2.02     0.67     5.96  Inf        4       NA</span></span>
<span><span class="co">#&gt; progVocational    -0.49      1.26    -2.66     0.42  Inf        4       NA</span></span>
<span><span class="co">#&gt; math               0.10      0.03     0.06     0.13  Inf        4       NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;                                    Estimate</span></span>
<span><span class="co">#&gt; shape 6464950012624176290022006848644662.00</span></span>
<span><span class="co">#&gt;                                    Est.Error          l-95% CI</span></span>
<span><span class="co">#&gt; shape 11199021826335432527262864286824266.00 21779500000000.00</span></span>
<span><span class="co">#&gt;                                     u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; shape 25859800000000002248084824408282220.00  Inf        4       NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>AME for a continuous variable, using default CI interval and
type.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span></span>
<span><span class="va">ame1.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span></span>
<span>  <span class="va">bayes.nb</span>,</span>
<span>  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>math <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME math"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame1.nb</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="15%">
<col width="14%">
<col width="6%">
<col width="9%">
<col width="6%">
<col width="5%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.641</td>
<td align="right">0.189</td>
<td align="right">0.042</td>
<td align="right">2.145</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME math</td>
</tr></tbody>
</table>
<p>AME for a categorical variable. Here we calculate pairwise contrasts
for all three program types. These are the predicted number of
awards.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ame2.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span></span>
<span>  <span class="va">bayes.nb</span>,</span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    prog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    <span class="st">"AME General v Academic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="st">"AME General v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="st">"AME Academic v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.nb</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="8%">
<col width="10%">
<col width="17%">
<col width="15%">
<col width="7%">
<col width="10%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.210</td>
<td align="right">0.218</td>
<td align="right">0.061</td>
<td align="right">0.345</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7.051</td>
<td align="right">2.021</td>
<td align="right">0.676</td>
<td align="right">23.486</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">0.209</td>
<td align="right">0.195</td>
<td align="right">0.015</td>
<td align="right">0.432</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.nb</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="7%">
<col width="8%">
<col width="7%">
<col width="12%">
<col width="11%">
<col width="5%">
<col width="7%">
<col width="5%">
<col width="4%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-6.841</td>
<td align="right">-1.803</td>
<td align="right">-23.425</td>
<td align="right">-0.331</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Academic</td>
</tr>
<tr class="even">
<td align="right">0.001</td>
<td align="right">-0.045</td>
<td align="right">-0.110</td>
<td align="right">0.206</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Vocational</td>
</tr>
<tr class="odd">
<td align="right">6.842</td>
<td align="right">1.851</td>
<td align="right">0.244</td>
<td align="right">23.421</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME Academic v Vocational</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>These references may be useful.</p>
<ul>
<li>Norton, E. C., Dowd, B. E., &amp; Maciejewski, M. L. (2019).
Marginal effects—quantifying the effect of changes in risk factors in
logistic regression models. <em>JAMA, 321</em>(13), 1304-1305.</li>
<li>Mize, T. D., Doan, L., &amp; Long, J. S. (2019). A general framework
for comparing predictions and marginal effects across models.
<em>Sociological Methodology, 49</em>(1), 152-189.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://joshuawiley.com" class="external-link">Joshua F. Wiley</a>, Donald Hedeker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
