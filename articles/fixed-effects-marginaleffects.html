<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="brmsmargins">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Marginal Effects for Fixed Effects Models • brmsmargins</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Marginal Effects for Fixed Effects Models">
<meta property="og:description" content="brmsmargins">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@WileyResearch">
<meta name="twitter:site" content="https://joshuawiley.com">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brmsmargins</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fixed-effects-marginaleffects.html">Marginal Effects for Fixed Effects Models</a>
    <a class="dropdown-item" href="../articles/mixed-effects-marginaleffects.html">Marginal Effects for Mixed Effects Models</a>
    <a class="dropdown-item" href="../articles/location-scale-marginaleffects.html">Marginal Effects for Location Scale Models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JWiley/brmsmargins/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        
        
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="fixed-effects-marginaleffects_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Marginal Effects for Fixed Effects Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JWiley/brmsmargins/blob/HEAD/vignettes/fixed-effects-marginaleffects.Rmd" class="external-link"><code>vignettes/fixed-effects-marginaleffects.Rmd</code></a></small>
      <div class="d-none name"><code>fixed-effects-marginaleffects.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="co">#&gt; data.table 1.14.2 using 24 threads (see ?getDTthreads).  Latest news: r-datatable.com</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: Rcpp</span>
<span class="co">#&gt; Loading 'brms' package (version 2.17.0). Useful instructions</span>
<span class="co">#&gt; can be found by typing help('brms'). A more detailed introduction</span>
<span class="co">#&gt; to the package is available through vignette('brms_overview').</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'brms'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     ar</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joshuawiley.com/brmsmargins/">brmsmargins</a></span><span class="op">)</span></code></pre></div>
<p>This vignette provides a brief overview of how to calculate marginal effects for Bayesian regression models involving only fixed effects and fit using the <code>brms</code> package.</p>
<div class="section level2">
<h2 id="what-are-marginal-effects">What are marginal effects?<a class="anchor" aria-label="anchor" href="#what-are-marginal-effects"></a>
</h2>
<p>Marginal effects can be used to describe how an outcome is predicted to change with a change in a predictor (or predictors). It is a derivative. For convenience, typically calculated numerically rather than analytically.</p>
<p>To motivate marginal effects, we can look at some regression models fit in a frequentist framework for simplicity and speed. Here we use the <code>mtcars</code> dataset built into <code>R</code>. First, we can look at a linear regression model of the association between <code>mpg</code> and <code>hp</code>. Here we can see the estimated regression coefficient for <code>mpg</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m.linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">hp</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m.linear</span><span class="op">)</span><span class="op">[</span><span class="st">"mpg"</span><span class="op">]</span>
<span class="co">#&gt;       mpg </span>
<span class="co">#&gt; -11.19988</span></code></pre></div>
<p>In linear models with no interactions, no (non linear) transformations, and a linear link function, the regression coefficient is the predicted change in the outcome for a one unit change in the predictor, regardless of any other values. For example, here we can look at the predicted difference in the outcome for a one unit difference in <code>mpg</code> from 0 to 1, holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.linear</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;         2 </span>
<span class="co">#&gt; -11.19988</span></code></pre></div>
<p>We can look at the same estimate but moving <code>mpg</code> from 10 to 11 instead 0 to 1, holding <code>am = 1</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.linear</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">1</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;         2 </span>
<span class="co">#&gt; -11.19988</span></code></pre></div>
<p>All of these quantities are identical. In this case, the regression coefficient can be interpreted as a marginal effect: the expected change in the outcome for a one unit shift in <code>mpg</code>, regardless of the value of <code>am</code> and regardless of the values where <code>mpg</code> is evaluated.</p>
<p>This convenient property does not hold for many types of models. Next consider a logistic regression model. The regression coefficient, shown below, is on the log odds scale, not the probability scale. This is not convenient for interpretation, as the log odds scale is not the same scale as our outcome.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m.logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span><span class="op">[</span><span class="st">"mpg"</span><span class="op">]</span>
<span class="co">#&gt;       mpg </span>
<span class="co">#&gt; 0.6809205</span></code></pre></div>
<p>We can find predicted differences on the probability scale. Here moving <code>mpg</code> from 10 to 11 holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;           2 </span>
<span class="co">#&gt; 0.002661989</span></code></pre></div>
<p>We can look at the same estimate but moving <code>mpg</code> from 20 to 21 instead 10 to 11 again holding <code>am = 0</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;         2 </span>
<span class="co">#&gt; 0.1175344</span></code></pre></div>
<p>We can look at the same estimate moving <code>mpg</code> from 20 to 21 as before, but this time holding <code>am = 1</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">1</span>, mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">yhat</span><span class="op">)</span>
<span class="co">#&gt;          2 </span>
<span class="co">#&gt; 0.08606869</span></code></pre></div>
<p>All the estimates in this case differ. The association between <code>mpg</code> and <strong>probability</strong> of <code>vs</code> is not linear. Marginal effects provide a way to get results on the response scale, which can aid interpretation.</p>
<p>A common type of marginal effect is an average marginal effect (AME). To calculate an AME numerically, we can get predicted probabilities from a model for every observation in the dataset. For continuous variables, we might use a very small difference to approximate the derivative. For categorical variables, we might calculate a discrete difference.</p>
<div class="section level3">
<h3 id="average-marginal-effect-ame">Average Marginal Effect (AME)<a class="anchor" aria-label="anchor" href="#average-marginal-effect-ame"></a>
</h3>
<p>Here is an example of a continuous AME. <code>h</code> is a value near to zero used for the numerical derivative. We take all the values observed in the dataset for the first set of predicted probabilities. Then we take the observed values + <code>h</code> and calculate new predicted probabilities. The difference, divided by <code>h</code> is the “instantaneous” (i.e., derivative) on the probability scale for a one unit shift in the predictor, <code>mpg</code>, for each person. When we average all of these, we get the AME.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>

<span class="va">nd.1</span> <span class="op">&lt;-</span> <span class="va">nd.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span>
<span class="va">nd.1</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="va">nd.1</span><span class="op">$</span><span class="va">mpg</span> <span class="op">+</span> <span class="va">h</span>

<span class="va">yhat.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.0</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="va">yhat.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.1</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">yhat.1</span> <span class="op">-</span> <span class="va">yhat.0</span><span class="op">)</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.06922997</span></code></pre></div>
<p>Here is an example of a discrete AME. The variable, <code>am</code> only takes two values: 0 or 1. So we calculate predicted probabilities if everyone had <code>am = 0</code> and then again if everyone had <code>am = 1</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nd.1</span> <span class="op">&lt;-</span> <span class="va">nd.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">m.logistic</span><span class="op">)</span>
<span class="va">nd.0</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">nd.1</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="va">yhat.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.0</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="va">yhat.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">m.logistic</span>,
  newdata <span class="op">=</span> <span class="va">nd.1</span>,
  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">yhat.1</span> <span class="op">-</span> <span class="va">yhat.0</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] -0.2618203</span></code></pre></div>
<p>In both these examples, we are averaging across the different values observed in the dataset. In a frequentist framework, additional details are needed to calculate uncertainty intervals. In a Bayesian framework, uncertainty intervals can be calculated readily by summarizing the posterior.</p>
</div>
</div>
<div class="section level2">
<h2 id="ames-for-logistic-regression">AMEs for Logistic Regression<a class="anchor" aria-label="anchor" href="#ames-for-logistic-regression"></a>
</h2>
<p>The main function for users to use is <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code>. Here is an example calculating AMEs for <code>mpg</code> and <code>am</code>. First we will fit the same logistic regression model using <code>brms</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bayes.logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span>
  <span class="va">vs</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>,
  family <span class="op">=</span> <span class="st">"bernoulli"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,
  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span>
<span class="co">#&gt; Compiling Stan program...</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayes.logistic</span><span class="op">)</span>
<span class="co">#&gt;  Family: bernoulli </span>
<span class="co">#&gt;   Links: mu = logit </span>
<span class="co">#&gt; Formula: vs ~ am + mpg </span>
<span class="co">#&gt;    Data: mtcars (Number of observations: 32) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept   -16.03      5.49   -28.79    -7.15 1.00     1797     1897</span>
<span class="co">#&gt; am           -3.77      1.82    -7.87    -0.71 1.00     1689     1766</span>
<span class="co">#&gt; mpg           0.86      0.30     0.38     1.57 1.00     1707     1842</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>Now we can use <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code>. We give it the model object, a <code>data.frame</code> of the values to be added, first 0, then (0 + h), and a contrast matrix. The default is a 99 percent credible interval, which we override here to 0.95. We use highest density intervals, which are the default. We also could have selected “ETI” for equal tail intervals. <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code> will return a list with the posterior of each prediction, a summary of the posterior for the predictions, the posterior for the contrasts, and a summary of the posterior for the contrasts. Here we just have the one contrast, but multiple could have been specified.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>
<span class="va">ame1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.logistic</span>,
  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME MPG"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  CI <span class="op">=</span> <span class="fl">0.95</span>, CIType <span class="op">=</span> <span class="st">"HDI"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame1</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.071</td>
<td align="right">0.07</td>
<td align="right">0.054</td>
<td align="right">0.091</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME MPG</td>
</tr></tbody>
</table>
<p>Now we can look at how we could calculate a discrete AME. This time we use the <code>at</code> argument instead of the <code>add</code> argument as we want to hold <code>am</code> at specific values, not add 0 and 1 to the observed <code>am</code> values. Because 0 and 1 are meaningful values of <code>am</code>, we also look at the summary of the posterior for the predictions. These predictions average across all values of <code>mpg</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ame2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.logistic</span>,
  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME am"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  CI <span class="op">=</span> <span class="fl">0.95</span>, CIType <span class="op">=</span> <span class="st">"HDI"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.543</td>
<td align="right">0.544</td>
<td align="right">0.419</td>
<td align="right">0.653</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.284</td>
<td align="right">0.277</td>
<td align="right">0.180</td>
<td align="right">0.409</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2</span><span class="op">$</span><span class="va">ContrastSummary</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">-0.258856</td>
<td align="right">-0.2648354</td>
<td align="right">-0.4252779</td>
<td align="right">-0.0862889</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.95</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME am</td>
</tr></tbody>
</table>
<p>Note that by default, <code><a href="../reference/brmsmargins.html">brmsmargins()</a></code> uses the model frame from the model object as the dataset. This, however, can be overridden. You can give it any (valid) dataset and it will add or override the chosen values and average across the predictions from the different rows of the dataset.</p>
</div>
<div class="section level2">
<h2 id="ames-for-poisson-regression">AMEs for Poisson Regression<a class="anchor" aria-label="anchor" href="#ames-for-poisson-regression"></a>
</h2>
<p>Here is a short example for Poisson regression used for count outcomes. We use a dataset drawn from: <a href="https://stats.oarc.ucla.edu/r/dae/poisson-regression/" class="external-link uri">https://stats.oarc.ucla.edu/r/dae/poisson-regression/</a></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"https://stats.oarc.ucla.edu/stat/data/poisson_sim.csv"</span><span class="op">)</span>
<span class="va">d</span><span class="op">[</span>, <span class="va">prog</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">prog</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>

<span class="va">bayes.poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span>
  <span class="va">num_awards</span> <span class="op">~</span> <span class="va">prog</span> <span class="op">+</span> <span class="va">math</span>, data <span class="op">=</span> <span class="va">d</span>,
  family <span class="op">=</span> <span class="st">"poisson"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,
  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span>
<span class="co">#&gt; Compiling Stan program...</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayes.poisson</span><span class="op">)</span>
<span class="co">#&gt;  Family: poisson </span>
<span class="co">#&gt;   Links: mu = log </span>
<span class="co">#&gt; Formula: num_awards ~ prog + math </span>
<span class="co">#&gt;    Data: d (Number of observations: 200) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept         -5.31      0.66    -6.66    -4.03 1.00     1933     2312</span>
<span class="co">#&gt; progAcademic       1.15      0.38     0.46     1.97 1.00     2088     1947</span>
<span class="co">#&gt; progVocational     0.39      0.47    -0.48     1.36 1.00     2174     2024</span>
<span class="co">#&gt; math               0.07      0.01     0.05     0.09 1.00     2592     2120</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>AME for a continuous variable, using default CI interval and type.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>
<span class="va">ame1.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.poisson</span>,
  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>math <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME math"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame1.p</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.044</td>
<td align="right">0.044</td>
<td align="right">0.026</td>
<td align="right">0.065</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME math</td>
</tr></tbody>
</table>
<p>AME for a categorical variable. Here we calculate pairwise contrasts for all three program types. These are the predicted number of awards.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ame2.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.poisson</span>,
  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
    prog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,
                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>
    <span class="st">"AME General v Academic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
    <span class="st">"AME General v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
    <span class="st">"AME Academic v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.p</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.263</td>
<td align="right">0.253</td>
<td align="right">0.076</td>
<td align="right">0.526</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.781</td>
<td align="right">0.779</td>
<td align="right">0.600</td>
<td align="right">0.988</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">0.380</td>
<td align="right">0.368</td>
<td align="right">0.126</td>
<td align="right">0.710</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.p</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.518</td>
<td align="right">-0.524</td>
<td align="right">-0.820</td>
<td align="right">-0.176</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Academic</td>
</tr>
<tr class="even">
<td align="right">-0.117</td>
<td align="right">-0.111</td>
<td align="right">-0.503</td>
<td align="right">0.280</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Vocational</td>
</tr>
<tr class="odd">
<td align="right">0.400</td>
<td align="right">0.406</td>
<td align="right">0.019</td>
<td align="right">0.726</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME Academic v Vocational</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="ames-for-negative-binomial-regression">AMEs for Negative Binomial Regression<a class="anchor" aria-label="anchor" href="#ames-for-negative-binomial-regression"></a>
</h2>
<p>Here is a short example for Negative Binomial regression used for count outcomes. We use the same setup as for the Poisson regression example.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://stats.oarc.ucla.edu/stat/data/poisson_sim.csv"</span><span class="op">)</span>
<span class="va">d</span><span class="op">$</span><span class="va">prog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">prog</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span>

<span class="va">bayes.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span>
  <span class="va">num_awards</span> <span class="op">~</span> <span class="va">prog</span> <span class="op">+</span> <span class="va">math</span>, data <span class="op">=</span> <span class="va">d</span>,
  family <span class="op">=</span> <span class="st">"negbinomial"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
  silent <span class="op">=</span> <span class="fl">2</span>, refresh <span class="op">=</span> <span class="fl">0</span>,
  chains <span class="op">=</span> <span class="fl">4L</span>, cores <span class="op">=</span> <span class="fl">4L</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span>
<span class="co">#&gt; Compiling Stan program...</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bayes.nb</span><span class="op">)</span>
<span class="co">#&gt;  Family: negbinomial </span>
<span class="co">#&gt;   Links: mu = log; shape = identity </span>
<span class="co">#&gt; Formula: num_awards ~ prog + math </span>
<span class="co">#&gt;    Data: d (Number of observations: 200) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept         -5.39      0.70    -6.82    -4.06 1.00     2813     2387</span>
<span class="co">#&gt; progAcademic       1.14      0.38     0.42     1.89 1.00     2187     2343</span>
<span class="co">#&gt; progVocational     0.40      0.47    -0.49     1.32 1.00     2155     2093</span>
<span class="co">#&gt; math               0.07      0.01     0.05     0.09 1.00     3139     2500</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; shape    19.82     35.82     1.91   112.92 1.00     2453     2214</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>AME for a continuous variable, using default CI interval and type.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.001</span>
<span class="va">ame1.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.nb</span>,
  add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>math <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME math"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame1.nb</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.045</td>
<td align="right">0.045</td>
<td align="right">0.022</td>
<td align="right">0.07</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME math</td>
</tr></tbody>
</table>
<p>AME for a categorical variable. Here we calculate pairwise contrasts for all three program types. These are the predicted number of awards.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ame2.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsmargins.html">brmsmargins</a></span><span class="op">(</span>
  <span class="va">bayes.nb</span>,
  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
    prog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,
                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"General"</span>, <span class="st">"Academic"</span>, <span class="st">"Vocational"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>
    <span class="st">"AME General v Academic"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
    <span class="st">"AME General v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
    <span class="st">"AME Academic v Vocational"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.nb</span><span class="op">$</span><span class="va">Summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.264</td>
<td align="right">0.251</td>
<td align="right">0.072</td>
<td align="right">0.562</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">0.781</td>
<td align="right">0.778</td>
<td align="right">0.565</td>
<td align="right">1.010</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">0.388</td>
<td align="right">0.374</td>
<td align="right">0.146</td>
<td align="right">0.756</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ame2.nb</span><span class="op">$</span><span class="va">ContrastSummary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">Mdn</th>
<th align="right">LL</th>
<th align="right">UL</th>
<th align="right">PercentROPE</th>
<th align="right">PercentMID</th>
<th align="right">CI</th>
<th align="left">CIType</th>
<th align="left">ROPE</th>
<th align="left">MID</th>
<th align="left">Label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.517</td>
<td align="right">-0.523</td>
<td align="right">-0.840</td>
<td align="right">-0.127</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Academic</td>
</tr>
<tr class="even">
<td align="right">-0.124</td>
<td align="right">-0.120</td>
<td align="right">-0.532</td>
<td align="right">0.270</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME General v Vocational</td>
</tr>
<tr class="odd">
<td align="right">0.392</td>
<td align="right">0.405</td>
<td align="right">-0.024</td>
<td align="right">0.768</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.99</td>
<td align="left">HDI</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">AME Academic v Vocational</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>These references may be useful.</p>
<ul>
<li>Norton, E. C., Dowd, B. E., &amp; Maciejewski, M. L. (2019). Marginal effects—quantifying the effect of changes in risk factors in logistic regression models. <em>JAMA, 321</em>(13), 1304-1305.</li>
<li>Mize, T. D., Doan, L., &amp; Long, J. S. (2019). A general framework for comparing predictions and marginal effects across models. <em>Sociological Methodology, 49</em>(1), 152-189.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://joshuawiley.com" class="external-link">Joshua F. Wiley</a>, Donald Hedeker.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
